# Rendre l'interface de Proxmox accessible depuis le port 443 (sans le port 8006)

1. Configuration de iptables
```
sudo iptables -t nat -A PREROUTING -i ens33 -p tcp --dport 443 -j REDIRECT --to-port 8006
```

-t nat : Utilise la table NAT pour la redirection.
-A PREROUTING : Ajoute la règle à la chaîne PREROUTING (avant le routage).
-i ens33 : Applique la règle uniquement au trafic entrant sur l'interface ens33 (**remplacez par votre interface réseau externe**).
-p tcp --dport 443 : Filtre les paquets TCP destinés au port 443.
-j REDIRECT --to-port 8006 : Redirige ces paquets vers le port 8006.

⚠️ **Important : pensez bien à changer l'interface réseau entrante !**

2. Installation de iptables persistent (les règles iptables sont temporaire)
```
apt install iptables-persistent -y
```

Dite "oui" pour sauvegarder vos règles iptables actuel

3. Vérifier que les règles sont bien sauvegarder
```
cat /etc/iptables/rules.v4
```

Exemple de sortie :
```
# Generated by iptables-save v1.8.9 on Tue Aug 12 23:19:30 2025
*nat
:PREROUTING ACCEPT [330:60739]
:INPUT ACCEPT [62:4607]
:OUTPUT ACCEPT [6:435]
:POSTROUTING ACCEPT [6:435]
-A PREROUTING -i ens33 -p tcp -m tcp --dport 443 -j REDIRECT --to-ports 8006
COMMIT
# Completed on Tue Aug 12 23:19:30 2025
# Generated by iptables-save v1.8.9 on Tue Aug 12 23:19:30 2025
*raw
:PREROUTING ACCEPT [13911095:2638262780]
:OUTPUT ACCEPT [4109493:2468032836]
COMMIT
# Completed on Tue Aug 12 23:19:30 2025
# Generated by iptables-save v1.8.9 on Tue Aug 12 23:19:30 2025
*filter
:INPUT ACCEPT [6486096:1272735110]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [4109493:2468032836]
COMMIT
# Completed on Tue Aug 12 23:19:30 2025
```

4. Installer UFW pour ouvrir le port 443
```
apt install ufw -y
```

5. Autoriser les ports :
```
ufw allow 443/tcp
ufw allow 22/tcp
ufw allow 8006/tcp
```

⚠️ **Important : quand vous activez UFW ils bloquent tous les ports, donc si vous n'avez pas ouvert le port SSH vous perdez l'accès à votre machine**

7. Activer ufw
```
ufw enable
```

6. Vérifier les ports 
```
sudo ufw status verbose
```

Exemple de sortie :
```
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), disabled (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
443/tcp                    ALLOW IN    Anywhere
22/tcp                     ALLOW IN    Anywhere
8006/tcp                   ALLOW IN    Anywhere
443/tcp (v6)               ALLOW IN    Anywhere (v6)
22/tcp (v6)                ALLOW IN    Anywhere (v6)
8006/tcp (v6)              ALLOW IN    Anywhere (v6)
```

7. Plus qu'à tester en accédants à l'adresse du Proxmox (en https).


 

